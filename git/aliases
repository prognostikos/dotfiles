# shellcheck shell=bash
alias ga='git add '
alias gaa='git add --update'
alias gA='git add --all'
alias gap='git add --patch --all'
alias gb='git branch '
alias gc='git commit -v '
gd() {
  if [ -n "$TMUX" ] && [ "$(tmux display-message -p '#{pane_width}')" -lt 120 ]; then
    tmux popup -w 90% -h 90% git diff "$@"
  else
    git diff "$@"
  fi
}
alias gdc='git diff --cached '
alias gcb='git checkout -b'
alias gco='git checkout '
alias got='git '
alias get='git '
alias gcm='git commit -m '
alias gp='git push '
alias ged='git edit'
alias gpf='git push --force-with-lease --force-if-includes'

_git_log_format='%Cred%h%Creset%C(yellow)%d%Creset %s %C(blue)%al%Creset'

gl() {
  local lines=$(($(tput lines) - 6))
  local n=$((lines > 20 ? lines : 20))
  git log --color --pretty=format:"$_git_log_format" --abbrev-commit -n "$n" "$@"
}

gll() {
  git log --color --pretty=format:"${_git_log_format} %C(cyan)%cr (%cs)%Creset" --abbrev-commit "$@"
}

gfx() {
  local default_branch
  default_branch=$(git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@')
  if [ -z "$default_branch" ]; then
    if git show-ref --verify --quiet refs/heads/main; then
      default_branch="main"
    else
      default_branch="master"
    fi
  fi
  local commit_hash
  commit_hash=$(git log $(git merge-base "$default_branch" HEAD)..HEAD --oneline | fzf | cut -d" " -f1)
  if [ -n "$commit_hash" ]; then
    git commit --fixup "$commit_hash"
  fi
}

gnm() {
  local default_branch
  default_branch=$(git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@')
  if [ -z "$default_branch" ]; then
    if git show-ref --verify --quiet refs/heads/main; then
      default_branch="main"
    else
      default_branch="master"
    fi
  fi
  git branch --no-merged "$default_branch"
}
